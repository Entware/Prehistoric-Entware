diff -urx .svn ../../../downloads/openwrt_trunk-r46338/package/network/services/samba36/Makefile ../../../openwrt_trunk/package/network/services/samba36/Makefile
--- ../../../downloads/openwrt_trunk-r46338/package/network/services/samba36/Makefile	2015-07-14 10:55:20.122308179 +0300
+++ ../../../openwrt_trunk/package/network/services/samba36/Makefile	2015-07-14 16:36:47.334650599 +0300
@@ -88,7 +88,7 @@
 	ac_cv_path_PYTHON_CONFIG=""
 
 CONFIGURE_ARGS += \
-	--exec-prefix=/usr \
+	--exec-prefix=/Apps/opt \
 	--prefix=/ \
 	--disable-avahi \
 	--disable-cups \
@@ -98,15 +98,15 @@
 	--disable-swat \
 	--disable-shared-libs \
 	--with-libiconv="$(ICONV_PREFIX)" \
-	--with-codepagedir=/etc/samba \
-	--with-configdir=/etc/samba \
+	--with-codepagedir=/Apps/opt/etc/samba \
+	--with-configdir=/Apps/opt/etc/samba \
 	--with-included-iniparser \
 	--with-included-popt \
-	--with-lockdir=/var/lock \
-	--with-logfilebase=/var/log \
-	--with-nmbdsocketdir=/var/nmbd \
-	--with-piddir=/var/run \
-	--with-privatedir=/etc/samba \
+	--with-lockdir=/Apps/opt/var/lock \
+	--with-logfilebase=/Apps/opt/var/log \
+	--with-nmbdsocketdir=/Apps/opt/var/nmbd \
+	--with-piddir=/Apps/opt/var/run \
+	--with-privatedir=/Apps/opt/etc/samba \
 	--with-sendfile-support \
 	--without-acl-support \
 	--without-cluster-support \
@@ -124,31 +124,29 @@
 MAKE_FLAGS += DYNEXP= PICFLAG= MODULES=
 
 define Package/samba36-server/conffiles
-/etc/config/samba
-/etc/samba/smb.conf.template
+/opt/etc/samba/smb.conf.template
 endef
 
 define Package/samba36-server/install
-	$(INSTALL_DIR) $(1)/etc/config
-	$(INSTALL_CONF) ./files/samba.config $(1)/etc/config/samba
-	$(INSTALL_DIR) $(1)/etc/samba
-	$(INSTALL_DATA) ./files/smb.conf.template $(1)/etc/samba
-	$(INSTALL_DATA) $(PKG_BUILD_DIR)/codepages/lowcase.dat $(1)/etc/samba
-	$(INSTALL_DATA) $(PKG_BUILD_DIR)/codepages/upcase.dat $(1)/etc/samba
-	$(INSTALL_DATA) $(PKG_BUILD_DIR)/codepages/valid.dat $(1)/etc/samba
-	$(INSTALL_DIR) $(1)/etc/init.d
-	$(INSTALL_BIN) ./files/samba.init $(1)/etc/init.d/samba
-	$(INSTALL_DIR) $(1)/usr/sbin
-	$(INSTALL_BIN) $(PKG_BUILD_BIN)/samba_multicall $(1)/usr/sbin
-	$(LN) samba_multicall $(1)/usr/sbin/smbd
-	$(LN) samba_multicall $(1)/usr/sbin/nmbd
-	$(LN) samba_multicall $(1)/usr/sbin/smbpasswd
+	$(INSTALL_DIR) $(1)/opt/etc/samba
+	$(INSTALL_DATA) ./files/smb.conf.template $(1)/opt/etc/samba
+	$(INSTALL_DATA) $(PKG_BUILD_DIR)/codepages/lowcase.dat $(1)/opt/etc/samba
+	$(INSTALL_DATA) $(PKG_BUILD_DIR)/codepages/upcase.dat $(1)/opt/etc/samba
+	$(INSTALL_DATA) $(PKG_BUILD_DIR)/codepages/valid.dat $(1)/opt/etc/samba
+	$(INSTALL_DIR) $(1)/opt/etc/init.d
+	$(INSTALL_BIN) ./files/S08samba $(1)/opt/etc/init.d
+	$(INSTALL_DIR) $(1)/opt/sbin
+	$(INSTALL_BIN) $(PKG_BUILD_BIN)/samba_multicall $(1)/opt/sbin
+	$(LN) samba_multicall $(1)/opt/sbin/smbd
+	$(LN) samba_multicall $(1)/opt/sbin/nmbd
+	$(LN) samba_multicall $(1)/opt/sbin/smbpasswd
+	$(INSTALL_DIR) $(1)/opt/var/nmbd
 endef
 
 define Package/samba36-client/install
-	$(INSTALL_DIR) $(1)/usr/sbin
-	$(INSTALL_BIN) $(PKG_BUILD_BIN)/smbclient $(1)/usr/sbin
-	$(INSTALL_BIN) $(PKG_BUILD_BIN)/nmblookup $(1)/usr/sbin
+	$(INSTALL_DIR) $(1)/opt/sbin
+	$(INSTALL_BIN) $(PKG_BUILD_BIN)/smbclient $(1)/opt/sbin
+	$(INSTALL_BIN) $(PKG_BUILD_BIN)/nmblookup $(1)/opt/sbin
 endef
 
 $(eval $(call BuildPackage,samba36-client))
diff -urx .svn ../../../downloads/openwrt_trunk-r46338/package/network/services/samba36/patches/111-owrt_smbpasswd.patch ../../../openwrt_trunk/package/network/services/samba36/patches/111-owrt_smbpasswd.patch
--- ../../../downloads/openwrt_trunk-r46338/package/network/services/samba36/patches/111-owrt_smbpasswd.patch	2015-07-14 10:55:20.122308179 +0300
+++ ../../../openwrt_trunk/package/network/services/samba36/patches/111-owrt_smbpasswd.patch	2015-07-14 10:55:53.234308695 +0300
@@ -236,15 +236,15 @@
 +		}
 +	}
 +
-+	fp = fopen("/etc/samba/smbpasswd", "r+");
++	fp = fopen("/Apps/opt/etc/samba/smbpasswd", "r+");
 +	if(!fp) {
-+		fprintf(stderr, "Failed to open /etc/samba/smbpasswd");
++		fprintf(stderr, "Failed to open /Apps/opt/etc/samba/smbpasswd");
 +		return 3;
 +	}
 +
 +	found = find_passwd_line(fp, user, NULL);
 +	if (!add && !found) {
-+		fprintf(stderr, "Could not find user '%s' in /etc/samba/smbpasswd\n", user);
++		fprintf(stderr, "Could not find user '%s' in /opt/etc/samba/smbpasswd\n", user);
 +		return 3;
 +	}
 +
